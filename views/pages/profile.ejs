<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <h1 class="page-title">My Profile</h1>
        <p class="page-subtitle">Manage your account information and preferences</p>
    </div>
</div>

<!-- Profile Content -->
<div class="page-content">
    <div class="container">
        <div class="profile-layout">
            <!-- Profile Sidebar -->
            <aside class="profile-sidebar">
                <div class="profile-card">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar">
                            <img src="<%= getUserAvatarUrl(user) %>"
                                 alt="<%= user.name %>"
                                 id="profile-image"
                                 class="enhanced-image"
                                 onerror="this.src='<%= getDefaultImage('user') %>'">
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="document.getElementById('photo-upload').click()">
                            <i class="fas fa-camera"></i>
                            Change Photo
                        </button>
                        <input type="file" id="photo-upload" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="profile-info">
                        <h3 class="profile-name"><%= user.name %></h3>
                        <p class="profile-email"><%= user.email %></p>
                        <span class="badge badge-<%= user.role %>">
                            <i class="fas fa-<%= user.role === 'instructor' ? 'chalkboard-teacher' : user.role === 'admin' ? 'crown' : 'user-graduate' %>"></i>
                            <%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %>
                        </span>
                        <% if (user.location) { %>
                            <p class="profile-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <%= user.location %>
                            </p>
                        <% } %>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat">
                            <span class="stat-label">Member Since</span>
                            <span class="stat-value"><%= new Date(user.createdAt).toLocaleDateString() %></span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Last Login</span>
                            <span class="stat-value"><%= user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never' %></span>
                        </div>
                    </div>
                </div>

                <!-- Profile Navigation -->
                <nav class="profile-nav">
                    <button class="profile-nav-item active" data-section="personal">
                        <i class="fas fa-user"></i>
                        Personal Information
                    </button>
                    <button class="profile-nav-item" data-section="security">
                        <i class="fas fa-shield-alt"></i>
                        Security
                    </button>
                    <button class="profile-nav-item" data-section="preferences">
                        <i class="fas fa-cog"></i>
                        Preferences
                    </button>
                    <button class="profile-nav-item" data-section="notifications">
                        <i class="fas fa-bell"></i>
                        Notifications
                    </button>
                    <% if (user.role === 'instructor') { %>
                        <button class="profile-nav-item" data-section="instructor">
                            <i class="fas fa-chalkboard-teacher"></i>
                            Instructor Profile
                        </button>
                    <% } %>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="profile-main">
                <!-- Personal Information Section -->
                <div class="profile-section active" id="personal">
                    <div class="section-header">
                        <h2 class="section-title">Personal Information</h2>
                        <p class="section-description">Update your personal details and contact information</p>
                    </div>
                    
                    <form id="personal-info-form" class="profile-form" method="POST" action="/profile">
                        <div class="form-group">
                            <label for="name" class="form-label">Full Name</label>
                            <input type="text" id="name" name="name" class="form-control"
                                   value="<%= user.name %>" required>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" id="email" name="email" class="form-control"
                                   value="<%= user.email %>" readonly>
                            <small class="form-help">Email cannot be changed. Contact support if needed.</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="tel" id="phone" name="phone" class="form-control" 
                                   value="<%= user.phone || '' %>" placeholder="+1 (555) 123-4567">
                        </div>
                        
                        <div class="form-group">
                            <label for="bio" class="form-label">Bio</label>
                            <textarea id="bio" name="bio" class="form-control" rows="4" 
                                      placeholder="Tell us about yourself..."><%= user.bio || '' %></textarea>
                            <small class="form-help">This will be visible on your public profile</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="location" class="form-label">Location</label>
                            <input type="text" id="location" name="location" class="form-control" 
                                   value="<%= user.location || '' %>" placeholder="City, Country">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                            <button type="button" class="btn btn-outline" onclick="resetForm('personal-info-form')">
                                <i class="fas fa-undo"></i>
                                Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Security Section -->
                <div class="profile-section" id="security">
                    <div class="section-header">
                        <h2 class="section-title">Security Settings</h2>
                        <p class="section-description">Manage your password and security preferences</p>
                    </div>
                    
                    <form id="password-form" class="profile-form" method="POST" action="/profile/password">
                        <div class="form-group">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <div class="password-input-group">
                                <input type="password" id="currentPassword" name="currentPassword" 
                                       class="form-control" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword" class="form-label">New Password</label>
                            <div class="password-input-group">
                                <input type="password" id="newPassword" name="newPassword" 
                                       class="form-control" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength" id="password-strength"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <div class="password-input-group">
                                <input type="password" id="confirmPassword" name="confirmPassword" 
                                       class="form-control" required>
                                <button type="button" class="password-toggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i>
                                Update Password
                            </button>
                        </div>
                    </form>
                    
                    <div class="security-options">
                        <h3>Two-Factor Authentication</h3>
                        <div class="security-option">
                            <div class="option-info">
                                <h4>Enable 2FA</h4>
                                <p>Add an extra layer of security to your account</p>
                            </div>
                            <div class="option-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enable-2fa" <%= user.twoFactorEnabled ? 'checked' : '' %>>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div class="profile-section" id="preferences">
                    <div class="section-header">
                        <h2 class="section-title">Preferences</h2>
                        <p class="section-description">Customize your learning experience</p>
                    </div>
                    
                    <form id="preferences-form" class="profile-form">
                        <div class="form-group">
                            <label for="language" class="form-label">Language</label>
                            <select id="language" name="language" class="form-control">
                                <option value="en" <%= user.preferences?.language === 'en' ? 'selected' : '' %>>English</option>
                                <option value="es" <%= user.preferences?.language === 'es' ? 'selected' : '' %>>Español</option>
                                <option value="fr" <%= user.preferences?.language === 'fr' ? 'selected' : '' %>>Français</option>
                                <option value="de" <%= user.preferences?.language === 'de' ? 'selected' : '' %>>Deutsch</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="timezone" class="form-label">Timezone</label>
                            <select id="timezone" name="timezone" class="form-control">
                                <option value="UTC" <%= user.preferences?.timezone === 'UTC' ? 'selected' : '' %>>UTC</option>
                                <option value="America/New_York" <%= user.preferences?.timezone === 'America/New_York' ? 'selected' : '' %>>Eastern Time</option>
                                <option value="America/Chicago" <%= user.preferences?.timezone === 'America/Chicago' ? 'selected' : '' %>>Central Time</option>
                                <option value="America/Denver" <%= user.preferences?.timezone === 'America/Denver' ? 'selected' : '' %>>Mountain Time</option>
                                <option value="America/Los_Angeles" <%= user.preferences?.timezone === 'America/Los_Angeles' ? 'selected' : '' %>>Pacific Time</option>
                            </select>
                        </div>
                        
                        <div class="preferences-group">
                            <h3>Learning Preferences</h3>
                            <div class="preference-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="autoplay" <%= user.preferences?.autoplay ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    Autoplay next video
                                </label>
                            </div>
                            
                            <div class="preference-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="showSubtitles" <%= user.preferences?.showSubtitles ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    Show subtitles by default
                                </label>
                            </div>
                            
                            <div class="preference-option">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="darkMode" <%= user.preferences?.darkMode ? 'checked' : '' %>>
                                    <span class="checkmark"></span>
                                    Dark mode
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Preferences
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Notifications Section -->
                <div class="profile-section" id="notifications">
                    <div class="section-header">
                        <h2 class="section-title">Notification Settings</h2>
                        <p class="section-description">Choose what notifications you want to receive</p>
                    </div>
                    
                    <form id="notifications-form" class="profile-form">
                        <div class="notifications-group">
                            <h3>Email Notifications</h3>
                            
                            <div class="notification-option">
                                <div class="option-info">
                                    <h4>Course Updates</h4>
                                    <p>Get notified when courses you're enrolled in are updated</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="courseUpdates" <%= user.notifications?.courseUpdates !== false ? 'checked' : '' %>>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-info">
                                    <h4>New Course Recommendations</h4>
                                    <p>Receive personalized course recommendations</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="recommendations" <%= user.notifications?.recommendations !== false ? 'checked' : '' %>>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="notification-option">
                                <div class="option-info">
                                    <h4>Marketing Emails</h4>
                                    <p>Receive updates about new features and promotions</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" name="marketing" <%= user.notifications?.marketing ? 'checked' : '' %>>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <% if (user.role === 'instructor') { %>
                                <div class="notification-option">
                                    <div class="option-info">
                                        <h4>Student Enrollments</h4>
                                        <p>Get notified when students enroll in your courses</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="enrollments" <%= user.notifications?.enrollments !== false ? 'checked' : '' %>>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="notification-option">
                                    <div class="option-info">
                                        <h4>Course Reviews</h4>
                                        <p>Get notified when students review your courses</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" name="reviews" <%= user.notifications?.reviews !== false ? 'checked' : '' %>>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            <% } %>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Notification Settings
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Instructor Profile Section -->
                <% if (user.role === 'instructor') { %>
                    <div class="profile-section" id="instructor">
                        <div class="section-header">
                            <h2 class="section-title">Instructor Profile</h2>
                            <p class="section-description">Manage your instructor profile and teaching information</p>
                        </div>
                        
                        <form id="instructor-form" class="profile-form">
                            <div class="form-group">
                                <label for="instructorBio" class="form-label">Instructor Bio</label>
                                <textarea id="instructorBio" name="instructorBio" class="form-control" rows="6" 
                                          placeholder="Tell students about your expertise and teaching experience..."><%= user.instructorProfile?.bio || '' %></textarea>
                                <small class="form-help">This will be displayed on your instructor profile and course pages</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="expertise" class="form-label">Areas of Expertise</label>
                                <input type="text" id="expertise" name="expertise" class="form-control" 
                                       value="<%= user.instructorProfile?.expertise ? user.instructorProfile.expertise.join(', ') : '' %>" 
                                       placeholder="e.g., Web Development, JavaScript, React">
                                <small class="form-help">Separate multiple areas with commas</small>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="website" class="form-label">Website</label>
                                    <input type="url" id="website" name="website" class="form-control" 
                                           value="<%= user.instructorProfile?.website || '' %>" 
                                           placeholder="https://yourwebsite.com">
                                </div>
                                <div class="form-group">
                                    <label for="linkedin" class="form-label">LinkedIn</label>
                                    <input type="url" id="linkedin" name="linkedin" class="form-control" 
                                           value="<%= user.instructorProfile?.linkedin || '' %>" 
                                           placeholder="https://linkedin.com/in/yourprofile">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Update Instructor Profile
                                </button>
                            </div>
                        </form>
                    </div>
                <% } %>

                <!-- Account Actions -->
                <div class="account-actions">
                    <h3>Account Actions</h3>
                    <div class="actions-list">
                        <button class="action-item action-download" onclick="downloadData()">
                            <div class="action-icon">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="action-content">
                                <h4>Download My Data</h4>
                                <p>Download a copy of your account data</p>
                            </div>
                        </button>
                        
                        <button class="action-item action-danger" onclick="deleteAccount()">
                            <div class="action-icon">
                                <i class="fas fa-trash"></i>
                            </div>
                            <div class="action-content">
                                <h4>Delete Account</h4>
                                <p>Permanently delete your account and all data</p>
                            </div>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div id="delete-account-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Delete Account</h3>
            <button type="button" class="modal-close" onclick="JooCourses.closeModal('delete-account-modal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="warning-message">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>This action cannot be undone</h4>
                <p>Deleting your account will permanently remove all your data, including:</p>
                <ul>
                    <li>Your profile and personal information</li>
                    <li>Course progress and certificates</li>
                    <% if (user.role === 'instructor') { %>
                        <li>All courses you've created</li>
                        <li>Student enrollments in your courses</li>
                    <% } %>
                    <li>Reviews and ratings</li>
                </ul>
            </div>
            
            <form id="delete-account-form">
                <div class="form-group">
                    <label for="deleteConfirmation" class="form-label">
                        Type "DELETE" to confirm:
                    </label>
                    <input type="text" id="deleteConfirmation" name="confirmation" 
                           class="form-control" placeholder="DELETE" required>
                </div>
                
                <div class="form-group">
                    <label for="deletePassword" class="form-label">Enter your password:</label>
                    <input type="password" id="deletePassword" name="password" 
                           class="form-control" required>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" onclick="JooCourses.closeModal('delete-account-modal')">
                Cancel
            </button>
            <button type="submit" form="delete-account-form" class="btn btn-error">
                <i class="fas fa-trash"></i>
                Delete My Account
            </button>
        </div>
    </div>
</div>

<% contentFor('style') %>
<link rel="stylesheet" href="/css/profile.css">

<% contentFor('script') %>
<script src="/js/profile.js"></script>
